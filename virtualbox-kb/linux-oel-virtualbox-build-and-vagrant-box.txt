===============================================================
BUILD A ORACLE LINUX VIRTUALBOX VM AND VAGRANT BOX FROM SCRATCH
===============================================================

Also see oracle12c-vm-build.txt

===========================================
HELP - WHICH LINUX RELEASE IS INSTALLED
===========================================
To determine which distribution and version of Linux is installed, enter the one of the following commands:

# cat /etc/oracle-release
# cat /etc/redhat-release
# lsb_release -id
To determine which distribution and version of IBM: Linux on System z is installed, enter the one of the following commands:

# cat /etc/SuSE-release
# cat /etc/redhat-release
# lsb_release -id
To determine whether the required kernel errata is installed, enter the following command:

# uname -r
The following is sample output displayed by running this command on an Oracle Linux 6 system:

2.6.39-100.7.1.el6uek.x86_64

===============================
LINUX ISO IMAGES
===============================
Oracle Linux 7 (7.2)
	
V100082-01.isoOracle Linux Release 7 Update 2 for x86_64 (64 Bit) 4.2 GB
V100083-01.isoOracle Linux Release 7 Update 2 source DVD 1 3.3 GB
V100084-01.isoOracle Linux Release 7 Update 2 source DVD 2 2.4 GB
V100085-01.isoOracle Linux Release 7 Update 2 UEK Boot ISO image for x86_64 (64 bit) 379.0 MB
V100086-01.isoOracle Linux Release 7 Update 2 Boot ISO image for x86_64 (64 bit) 364.0 MB

===============================
VM AND LINUX OPTIONS
===============================
Oracle Linux 7.2 64bit
VM Disk 40gb auto grow

Language - English, India

Software Selection - Server with GUI option

  Add-ons:
	DNS Name server
	Identity management server
	NFS client
	Performance Tools
	Remote Management for Linux
	Hardware monitoring utilities
	Large systems performance
	Java platform
	KDE
	Compatibility libraries
	Development tools
	Security tools

System - 
chose manual partitioning,
did not change partition scheme itself -
kept /boot / and swap fs, did not add more
swap was defaulted to 4GB, kept it as is
boot defaulted to 500mb, kept it as is
Changed / and swap to LVM - with new volume group rootvg
Kept /boot as 'standard partition'
File System defaulted to 'xfs' type (except swap which has 'swap' as fs) 
- changed to ext4 to be in the known space though OEL7/RHEL7 defaults to xfs 
(CAUTION - xfs disallows shrinking of f/s - 
but that is ok probably as '/' is going to be the only usable fs for now (than /opt, /apps etc separated)

Click 'start install' -
The next screen starts install, and also shows 'root password' button
--> click root password button and set the root password

Did not add more users to create (like Vagrant...) which can be done later


Click 'start install'
The next screen starts install, and also shows 'root password' button
--> click root password button and set the root password

Did not add more users to create (like Vagrant...) which can be done later

ERROR - During reboot - failed to insert module autofsf4 (may need guest additions)

In the black non GUI screen, accept license agreement, and choose user creation (seems like user creation is inevitable)
--> then choose quit or continue (cannot remember correctly) to proceed to next GUI steps

Choose language - English India
Choose Keyboard - India with Rupee sign
Choose timezone - Bangalore 
Create user - user1, name user1, password (some)
--> DO NOT click 'setup enterprise logon' --> just click next

============
NEXT STEPS
============
 (look after this section for each item details) (also see https://docs.oracle.com/database/121/CWLIN/prelinux.htm#CEGDDFII)
Install guest additions
Stop NTP
Install oracle preinstall rpm / validation rpm
Install oracleasm modules
PAM modules
Check if open-jdk is good enough (and version) and install Oracle's JDK if that is better

========================
Install guest additions-
========================
Logon as root
Click Devices --> Insert Guest Additions CD Image
- That will mount the ISO that Virtualbox software already has to install guest-additions on the machine
In OEL 7 it pops up a window that says the image is  intended to be automatically started 
--> click  run
It will install the guest-additions software with a black non-gui screen
upon completion, press enter in that screen to exit out of that
--> At this time, mouse integration between host and guest will be active 

Set guest monitor size/resolution-
KDE seemed to max out at 1024x768
xrandr -q also showed the same
However, upon restart of the VM it was fine (probably guest additions install and restart after that fixes it)
After restart, xrandr shows this:
1366x64
1366x664      60.00*+

You can change a few more settings for interaction between host and guest:
- Enable drag and drop between them - from 'Devices --> Drag and Drop'
- Share clipboard (copy-paste) - from 'Devices --> shared clipboard'

============
Stop NTP
============
# service ntpd stop
Redirecting to /bin/systemctl stop  ntpd.service
# chkconfig ntpd off
Note: Forwarding request to 'systemctl disable ntpd.service'.
# mv /etc/ntp.conf /etc/ntp.conf.orig

=============
Configure Yum
=============
Oracle Yum repository should be already there.
---------
Check it
---------
# cd /etc/yum.repos.d
# ls -l
-rw-r--r--. 1 root root 2560 Nov 19  2015 public-yum-ol7.repo

--------------
Enable Addons
--------------
In the yum.repos.d file, set enabled=1 in addons section:

[ol7_addons]
name=Oracle Linux $releasever Add ons ($basearch)
baseurl=http://public-yum.oracle.com/repo/OracleLinux/OL7/addons/$basearch/
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-oracle
gpgcheck=1
enabled=1

----------------------
Ensure GPG key exists (or download if it does not)
----------------------
# ls -l /etc/pki/rpm-gpg/RPM-GPG-KEY-oracle
-rw-r--r--. 1 root root 1011 Nov 25  2015 /etc/pki/rpm-gpg/RPM-GPG-KEY-oracle

================================
Install oracle preinstall rpm
================================
For yum command - https://www.krenger.ch/blog/oracle-linux-7-oracle-rdbms-server-12cr1-preinstall/
(or https://docs.oracle.com/database/121/CWLIN/olinrpm.htm#CWLIN173)
For rpm file downloads - https://oracle-base.com/blog/2015/03/26/oracle-linux-7-1-preinstall-packages-available-for-11gr2-and-12cr1/ 
- http://public-yum.oracle.com/repo/OracleLinux/OL7/1/base/x86_64/getPackage/oracle-rdbms-server-11gR2-preinstall-1.0-3.el7.x86_64.rpm
- http://public-yum.oracle.com/repo/OracleLinux/OL7/1/base/x86_64/getPackage/oracle-rdbms-server-12cR1-preinstall-1.0-3.el7.x86_64.rpm

# yum install oracle-rdbms-server-12cR1-preinstall
