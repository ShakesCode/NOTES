=====================================
      POSTGRES TRAINING NOTES
=====================================

commitfest.postgresql.org

MariaDB is not opensource anymore - they have a new capability 'max...' so not opensource anymore

Postgres is extensible - can define new datatypes, functions, can use other languages for stored procs (like JS, Java...)

Default port - 5432
Binaries - /usr/pgsql-<version>/bin 
Data - /var/lib/pgsql/<version>/data
Config files - in Data directory - postgresql.conf, postgresql.auto.conf, pg_hba.conf, pg_ident.conf
SQL client 'psql' - /usr/bin/psql -> /etc/alternatives/pgsql-psql

CHECK STATUS OF THE SERVICE:
$ pg_ctl status -D /var/lib/pgsql/9.5/data
pg_ctl: server is running (PID: 3124)
/usr/pgsql-9.5/bin/postgres "-D" "/var/lib/pgsql/9.5/data"

STOP THE SERVICE:
$ pg_ctl stop -D /var/lib/pgsql/9.5/data
waiting for server to shut down.... done
server stopped

START THE SERVICE:
$ pg_ctl start -D /var/lib/pgsql/9.5/data

CAUTION:
You can run multiple instances to run on the same machine - however it is NOT ADVISABLE
--> One instance may hog up all CPU and the others are starved
--> 

TABLESPACES:
Not advisable as the 'restore' server should have the same folder structure??
Tablespaces are probably good when we have to host one DB on SSD, other on traditional disks etc.

BACKUPS:
CAUTION: Hot/physical backups are at instance level - so if instance becomes too large then backup/recovery becomes difficult
            For this, create VMs and distribute databases across multiple instances on those VMs

MANAGEMENT TOOLS:
$ pg_ctl
# /etc/init.d/postgres*
# service postgresql-9.5 initdb
      The service command supports only basic LSB actions (start, stop, restart, try-restart, reload, force-reload, status). 
      For other actions, please try to use systemctl.

CONNECTIVITY CONFIGURATION:
postgresql.conf
listen_addresses = 'localhost,127.0.0.1,<local actual hostname>'
#listen_addresses = '*'
#listen_addresses = 'localhost'         # what IP address(es) to listen on;

CLIENT AUTHENTICATION CONFIGURATION:
pg_hba.conf

INSTANCE CONFIGURATION:
postgresql.conf
ALTER SYSTEM SET max_connections=200;
- stored in postgresql.auto.conf
- overrides postgresql.conf
- always in dat dir, irrespective of where postgresql.conf is stored
Needs to restart/reload to take effect in the file :
--> some need restart of postgres itself
--> some work with pg_reload_conf (like work_mem)
      psql# alter system set work_mem=5000;
      psql#  select pg_reload_conf();
       pg_reload_conf
      ----------------
       t
      (1 row)
      
      psql# show work_mem;
       work_mem
      ----------
       5000kB
      (1 row)

