===================================================
    CONFIGURE EUS FOR 12C RAC DB IN OUD 11G 
===================================================
Go through oud-11g-eus-11gDB-configure-and-use.txt for creating a root user, organization and enterprise user etc.

In this, we will use the root user, OU, realm and enterprise user created in oud-11g-eus-11gDB-configure-and-use.txt itself.

=======================================
---------------------------------------
            EUS FOR 12C CDB
---------------------------------------
=======================================
DB=L4D2

======================
REGISTER DB IN OUD
======================
$ dbca -silent -configureDatabase -sourceDB DB_UNIQUE_NAME -sysDBAUserName sys -sysDBAPassword "oracle#1" -registerWithDirService true -dirServiceUserName cn='eusroot,ou=eusadmins,dc=example,dc=com' -dirServicePassword oracle#1 -walletPassword 'oracle#1' -listeners listener

-- To unregister
$ dbca -silent -configureDatabase -sourceDB DB_UNIQUE_NAME -unregisterWithDirService true -dirServiceUserName cn='eusroot,ou=eusadmins,dc=example,dc=com' -dirServicePassword oracle#1 -walletPassword 'oracle#1' -listeners listener

- VERIFY with ldapsearch
$ ldapsearch -h 10.63.160.170 -p 1389 -D  cn='eusroot,ou=eusadmins,dc=example,dc=com' -w oracle#1 -b cn=oraclecontext,dc=example,dc=com "(cn=DB_UNIQUE_NAME)"
cn=DB_UNIQUE_NAME,cn=OracleContext,dc=example,dc=com
orclVersion=121000
orclcommonrpwdattribute={SASL-MD5}DnRGGBHXXflcD37D1w1n4Q==
objectClass=orclApplicationEntity
objectClass=orclService
objectClass=orclDBServer_92
objectClass=orclDBServer
objectClass=top
orclServiceType=DB
cn=RL4DB2_TTCE
orclOracleHome=/u02/app/oracle/product/12.1.0.2.RAC
orclSystemName=host-name-of-db-cluster-from-where-dbca-was-run
userPassword={AES}AZaBCiO8M0aMmrRbAnBEOV+IHy3h9njm1JnLJjq9KPVZrz5RHPkHyJgFi9Qf
userPassword={SSHA}fAYa+9kUa4M99PEtXurYGckhAMUrLOUkyLnc9A==
orclNetDescString=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=clustername-scan)(PORT=1522)))(CONNECT_DATA=(SERVICE_NAME=DB_UNIQUE_NAME)))
orclDBGlobalName=DB_UNIQUE_NAME
orclNetDescName=000:cn=DESCRIPTION_0

- VERIFY with eusm
$ eusm listDBInfo realm_dn='dc=example,dc=com' database_name=DB_UNIQUE_NAME ldap_host=10.63.160.170 ldap_port=1389 ldap_user_dn='cn=eusroot,ou=eusadmins,dc=example,dc=com' ldap_user_password=oracle#1

INFOMATION FOR DATABASE: DB_UNIQUE_NAME
-------------------------------------------------
Database Distinguished name: cn=DB_UNIQUE_NAME,cn=OracleContext,dc=example,dc=com
Database version:       121000
ORACLE_SID:             null
Database Host:          host-name-of-db-cluster-from-where-dbca-was-run
ORACLE_HOME:            /u02/app/oracle/product/12.1.0.2.RAC
Database Service:       DB
Global Database Name:   RL4DB2_TTCE
Oracle Net Description: (DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=clustername-scan)(PORT=1522)))(CONNECT_DATA=(SERVICE_NAME=DB_UNIQUE_NAME)))

- VERIFY IN OUD WHERE THIS DB IS REGISTGERED
NOTE: It is created as a cn directly under OracleContext of dc=example,dc=com

Go to 'Data Browser' --> 'Data Tree' 
     --> dc=example,dc=com --> cn=OracleContext 
     
          --> cn=DB_UNIQUE_NAME  
          
               --> under that there will be the following 'cn' items:
                    DESCRIPTION_0
                    OracleDBAdmins
                    OracleDBAgents ... etc
                    
 --> In the optional attributes on the RHS side, find the password for DB to authenticate to OUD < needs IE to copy pw probably)

- VERIFY IF WALLET HAS BEEN CREATED
$ cd /u02/app/oracle/admin/DB_UNIQUE_NAME/wallet
$ ls -l
-rw------- 1 oracle oradba 485 Jan  5 06:38 cwallet.sso
-rw-rw-rw- 1 oracle oradba   0 Jan  5 06:38 cwallet.sso.lck
-rw------- 1 oracle oradba 440 Jan  5 06:38 ewallet.p12
-rw-rw-rw- 1 oracle oradba   0 Jan  5 06:38 ewallet.p12.lck

- VERIFY IF DB IS IN THE WALLET
$  orapki wallet display -wallet .
Oracle PKI Tool : Version 12.1.0.2
Copyright (c) 2004, 2014, Oracle and/or its affiliates. All rights reserved.

Requested Certificates:
User Certificates:
Oracle Secret Store entries:
ORACLE.SECURITY.DN
ORACLE.SECURITY.PASSWORD
Trusted Certificates:

$ mkstore -wrl . -viewEntry ORACLE.SECURITY.DN
Oracle Secret Store Tool : Version 12.1.0.2
Copyright (c) 2004, 2014, Oracle and/or its affiliates. All rights reserved.

Enter wallet password: <oracle#1>
ORACLE.SECURITY.DN = cn=DB_UNIQUE_NAME,cn=OracleContext,dc=example,dc=com

$ mkstore -wrl . -viewEntry ORACLE.SECURITY.PASSWORD
Oracle Secret Store Tool : Version 12.1.0.2
Copyright (c) 2004, 2014, Oracle and/or its affiliates. All rights reserved.

Enter wallet password:
ORACLE.SECURITY.PASSWORD = 2Mnp14j=Wz88
--> This is the password for the DB DN in OUD

- VERIFY USING LDAPBIND
$ ldapbind -h 10.63.160.170 -p 1389 -D cn=DB_UNIQUE_NAME,cn=OracleContext,dc=example,dc=com -q
password: < give the password found as value of ORACLE.SECURITY.PASSWORD >
bind successful

-----------------------------------
ASSIGN CERTIFICATE TO WALLET
-----------------------------------
NOTE: Certificate is created with keytool - self-signed (see install document)
NOTE: This is the certificate entry in orapki wallet display output - Subject: CN=oudhost.company.com,O=CompanyName,C=US  

- Add certificate
$ orapki wallet add -wallet /u02/app/oracle/admin/DB_UNIQUE_NAME/wallet -cert ./oud-server-cert.txt -trusted_cert -pwd "oracle#1"

- Verify - NOTE: This is much shorter compared to 11g display - need to check that why
$ orapki wallet display -wallet /u02/app/oracle/admin/DB_UNIQUE_NAME/wallet
Requested Certificates:
User Certificates:
Oracle Secret Store entries:
ORACLE.SECURITY.DN
ORACLE.SECURITY.PASSWORD
Trusted Certificates:
Subject:        CN=CN=oudhost.company.com,O=CompanyName,C=US

====================================
CREATE SCHEMA, ROLES, GLOBAL USERS
====================================
NOTE: In CDB, let us not create any application schema.
      Let us try only a DBA user (and later, a sysdba user - which may be same enterprise user)
NOTE: Created a shorter named c##oud_global_ident_user instead of too-long-erroring c##oud_global_ident_schema_user
spool 12ccdbsetup

set echo on

create role c##oud_appwrite_role_local;
create role c##oud_appread_role_local;

create role c##oud_appwrite_role_global identified globally;
create role c##oud_appread_role_global identified globally;
create role c##oud_dba_role_global identified globally;

grant dba     to c##oud_dba_role_global;
grant connect to c##oud_dba_role_global;

create user c##oud_global_ident_user  identified globally;

spool off

====================================================
MAP IN OUD THE GLOBAL IDENT USER FOR THIS DB 
====================================================
NOTE: 12c eusm is erroring out. Therefore, use 11g eusm.

-------------------------
DO THE MAPPING
-------------------------
$ eusm createMapping database_name=DB_UNIQUE_NAME realm_dn='dc=example,dc=com' map_type=SUBTREE map_dn='dc=example,dc=com' schema=c##oud_global_ident_user ldap_host=10.63.160.170 ldap_port=1389 ldap_user_dn='cn=eusroot,ou=eusadmins,dc=example,dc=com' ldap_user_password=oracle#1

NOTE: This command does not produce any screen output
          Therefore, verify using listmappings:
